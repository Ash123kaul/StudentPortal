<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Alerts | Student Success Portal</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ“</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .logo h1 {
            color: #333;
            font-size: 1.8rem;
        }

        /* Navigation */
        #main-nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }

        #main-nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        #main-nav a:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        #main-nav a.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .user-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: #667eea;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .select-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .textarea-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        /* Student List */
        .student-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .student-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .student-item:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .student-item.selected {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .student-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .student-details {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .student-phone {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-container input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Alert Templates */
        .alert-templates {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .template-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .template-card.selected {
            background: #e3f2fd;
            border-color: #2196F3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
        }

        .template-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .template-message {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        /* Message Preview */
        .message-preview {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .preview-title {
            font-weight: 600;
            color: #333;
        }

        .preview-content {
            color: #666;
            line-height: 1.5;
        }

        .preview-meta {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #888;
        }

        /* Status Messages */
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
        }

        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #ffeaea;
            color: #d32f2f;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #b3e0ff;
        }

        /* History Section */
        .history-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-content {
            flex: 1;
        }

        .history-message {
            margin-bottom: 5px;
            color: #333;
        }

        .history-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .history-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-sent {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status-failed {
            background: #ffeaea;
            color: #d32f2f;
        }

        .status-pending {
            background: #fff3e0;
            color: #ef6c00;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .alert-templates {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            #main-nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon"><i class="fas fa-graduation-cap"></i></div>
                    <h1>Student Success Portal</h1>
                </div>
                <nav id="main-nav">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="alerts.html">Alerts</a></li>
                        <li><a href="#contact">Contact</a></li>
                        <li><a href="help.html">Help</a></li>
                    </ul>
                </nav>
                <div class="user-actions">
                    <button class="btn btn-outline" onclick="clearForm()">Clear Form</button>
                    <a href="dashboard.html"><button class="btn btn-primary">Dashboard</button></a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Send Alerts Card -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-sms"></i> Send Mobile Alerts</h2>
                
                <div class="form-group">
                    <label for="recipientType">Send To:</label>
                    <select id="recipientType" class="select-control" onchange="toggleRecipientOptions()">
                        <option value="single">Single Student</option>
                        <option value="multiple">Multiple Students</option>
                        <option value="all">All Students</option>
                        <option value="custom">Custom Number</option>
                    </select>
                </div>

                <!-- Single Student Selection -->
                <div id="singleStudentSection" class="form-group">
                    <label for="studentSelect">Select Student:</label>
                    <select id="studentSelect" class="select-control">
                        <!-- Students will be populated by JavaScript -->
                    </select>
                </div>

                <!-- Multiple Students Selection -->
                <div id="multipleStudentsSection" class="form-group" style="display: none;">
                    <label>Select Students:</label>
                    <div class="student-list">
                        <!-- Student list will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Custom Number -->
                <div id="customNumberSection" class="form-group" style="display: none;">
                    <label for="customNumber">Phone Number:</label>
                    <input type="tel" id="customNumber" class="form-control" placeholder="+91 9876543210">
                </div>

                <div class="form-group">
                    <label for="alertType">Alert Type:</label>
                    <select id="alertType" class="select-control" onchange="loadTemplate()">
                        <option value="">-- Select Alert Type --</option>
                        <option value="attendance">Low Attendance</option>
                        <option value="fees">Fee Payment Reminder</option>
                        <option value="marks">Low Marks Alert</option>
                        <option value="general">General Information</option>
                        <option value="emergency">Emergency Alert</option>
                        <option value="custom">Custom Message</option>
                    </select>
                </div>

                <!-- Alert Templates -->
                <div id="templatesSection" class="form-group">
                    <label>Quick Templates:</label>
                    <div class="alert-templates">
                        <div class="template-card" onclick="selectTemplate('attendance')">
                            <div class="template-title">Low Attendance</div>
                            <div class="template-message">Your attendance is below 75%. Please improve to avoid detention.</div>
                        </div>
                        <div class="template-card" onclick="selectTemplate('fees')">
                            <div class="template-title">Fee Reminder</div>
                            <div class="template-message">Fee payment is pending. Please pay before due date to avoid penalties.</div>
                        </div>
                        <div class="template-card" onclick="selectTemplate('marks')">
                            <div class="template-title">Low Marks</div>
                            <div class="template-message">Your marks are below expectations. Contact your faculty for guidance.</div>
                        </div>
                        <div class="template-card" onclick="selectTemplate('parent')">
                            <div class="template-title">Parent Alert</div>
                            <div class="template-message">Your ward needs attention in academics. Please contact the college.</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="messageContent">Message Content:</label>
                    <textarea id="messageContent" class="textarea-control" placeholder="Type your message here... (Max 160 characters)" maxlength="160"></textarea>
                    <div style="text-align: right; margin-top: 5px; font-size: 0.9rem; color: #666;">
                        <span id="charCount">0</span>/160 characters
                    </div>
                </div>

                <div class="checkbox-container">
                    <input type="checkbox" id="sendToParent" onchange="toggleParentOption()">
                    <label for="sendToParent">Also send to parent/guardian</label>
                </div>

                <div class="form-group">
                    <label for="scheduleTime">Schedule Message:</label>
                    <input type="datetime-local" id="scheduleTime" class="form-control">
                </div>

                <button class="btn btn-primary" style="width: 100%; padding: 15px;" onclick="sendAlert()">
                    <i class="fas fa-paper-plane"></i> Send Alert
                </button>

                <div id="statusMessage"></div>
            </div>

            <!-- Message Preview Card -->
            <div class="card">
                <h2 class="card-title"><i class="fas fa-eye"></i> Message Preview</h2>
                
                <div class="message-preview">
                    <div class="preview-header">
                        <div class="preview-title">SMS Preview</div>
                        <div style="font-size: 0.9rem; color: #666;">
                            <i class="fas fa-mobile-alt"></i> Mobile View
                        </div>
                    </div>
                    <div class="preview-content" id="messagePreview">
                        Your message will appear here...
                    </div>
                    <div class="preview-meta">
                        <div><strong>To:</strong> <span id="previewRecipient">Not selected</span></div>
                        <div><strong>Length:</strong> <span id="previewLength">0</span> characters</div>
                        <div><strong>Type:</strong> <span id="previewType">Standard SMS</span></div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: #333;">Recent Activity</h3>
                    <div class="history-list" id="recentActivity">
                        <!-- Recent activity will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="history-section">
            <h2 class="card-title"><i class="fas fa-history"></i> Alert History</h2>
            <div class="history-list" id="alertHistory">
                <!-- Alert history will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Sample student data
        const students = [
            { id: 1, name: "Rahul Sharma", rollNo: "2023001", phone: "+91 9876543210", parentPhone: "+91 9876543211", attendance: 68, feesPaid: false },
            { id: 2, name: "Priya Patel", rollNo: "2023002", phone: "+91 9876543212", parentPhone: "+91 9876543213", attendance: 82, feesPaid: true },
            { id: 3, name: "Amit Kumar", rollNo: "2023003", phone: "+91 9876543214", parentPhone: "+91 9876543215", attendance: 45, feesPaid: false },
            { id: 4, name: "Sneha Singh", rollNo: "2023004", phone: "+91 9876543216", parentPhone: "+91 9876543217", attendance: 75, feesPaid: true },
            { id: 5, name: "Rajesh Verma", rollNo: "2023005", phone: "+91 9876543218", parentPhone: "+91 9876543219", attendance: 58, feesPaid: false }
        ];

        // Alert templates
        const templates = {
            attendance: "Dear student, your attendance is currently {attendance}%, which is below the required 75%. Please improve your attendance to avoid detention.",
            fees: "Reminder: Your fee payment of â‚¹25,000 is due on {dueDate}. Please pay before the deadline to avoid late fees.",
            marks: "Alert: Your performance in {subject} needs improvement. Current marks: {marks}%. Contact your faculty for guidance.",
            parent: "Dear Parent, your ward {studentName} needs attention in academics. Current attendance: {attendance}%. Please contact the college.",
            general: "Important: {message}",
            emergency: "URGENT: {message} Please take immediate action."
        };

        // Alert history
        let alertHistory = JSON.parse(localStorage.getItem('alertHistory')) || [];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateStudentSelect();
            populateStudentList();
            updateMessagePreview();
            loadAlertHistory();
            loadRecentActivity();
            
            // Add event listeners
            document.getElementById('messageContent').addEventListener('input', updateMessagePreview);
            document.getElementById('studentSelect').addEventListener('change', updateMessagePreview);
        });

        // Populate student dropdown
        function populateStudentSelect() {
            const select = document.getElementById('studentSelect');
            select.innerHTML = '<option value="">-- Select Student --</option>';
            
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.rollNo}) - ${student.phone}`;
                select.appendChild(option);
            });
        }

        // Populate student list for multiple selection
        function populateStudentList() {
            const container = document.getElementById('multipleStudentsSection');
            const studentList = container.querySelector('.student-list');
            studentList.innerHTML = '';
            
            students.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <div class="student-avatar">${student.name.charAt(0)}</div>
                    <div class="student-info">
                        <div class="student-name">${student.name}</div>
                        <div class="student-details">
                            <span>${student.rollNo}</span>
                            <span class="student-phone"><i class="fas fa-phone"></i> ${student.phone}</span>
                            <span>Attendance: ${student.attendance}%</span>
                        </div>
                    </div>
                    <input type="checkbox" class="student-checkbox" value="${student.id}">
                `;
                studentList.appendChild(studentItem);
                
                // Add click event to select student
                studentItem.addEventListener('click', function(e) {
                    if (e.target.type !== 'checkbox') {
                        const checkbox = this.querySelector('.student-checkbox');
                        checkbox.checked = !checkbox.checked;
                        this.classList.toggle('selected', checkbox.checked);
                    }
                });
            });
        }

        // Toggle recipient options based on selection
        function toggleRecipientOptions() {
            const recipientType = document.getElementById('recipientType').value;
            
            document.getElementById('singleStudentSection').style.display = 
                recipientType === 'single' ? 'block' : 'none';
            document.getElementById('multipleStudentsSection').style.display = 
                recipientType === 'multiple' ? 'block' : 'none';
            document.getElementById('customNumberSection').style.display = 
                recipientType === 'custom' ? 'block' : 'none';
            
            updateMessagePreview();
        }

        // Load template based on alert type
        function loadTemplate() {
            const alertType = document.getElementById('alertType').value;
            const messageContent = document.getElementById('messageContent');
            
            if (alertType && alertType !== 'custom') {
                let template = templates[alertType];
                
                // Replace placeholders with actual data
                const selectedStudentId = document.getElementById('studentSelect').value;
                if (selectedStudentId) {
                    const student = students.find(s => s.id == selectedStudentId);
                    if (student) {
                        template = template.replace('{studentName}', student.name)
                                          .replace('{attendance}', student.attendance)
                                          .replace('{dueDate}', '2024-03-15')
                                          .replace('{subject}', 'Mathematics')
                                          .replace('{marks}', '65');
                    }
                }
                
                messageContent.value = template;
            } else if (alertType === 'custom') {
                messageContent.value = '';
            }
            
            updateMessagePreview();
        }

        // Select template from quick templates
        function selectTemplate(type) {
            document.getElementById('alertType').value = type;
            loadTemplate();
            
            // Update template card selection
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        // Toggle parent option
        function toggleParentOption() {
            updateMessagePreview();
        }

        // Update message preview
        function updateMessagePreview() {
            const message = document.getElementById('messageContent').value;
            const preview = document.getElementById('messagePreview');
            const charCount = document.getElementById('charCount');
            const previewLength = document.getElementById('previewLength');
            const previewRecipient = document.getElementById('previewRecipient');
            const previewType = document.getElementById('previewType');
            
            // Update preview content
            preview.textContent = message || 'Your message will appear here...';
            
            // Update character count
            const length = message.length;
            charCount.textContent = length;
            previewLength.textContent = length;
            
            // Update recipient info
            const recipientType = document.getElementById('recipientType').value;
            let recipientText = '';
            
            switch(recipientType) {
                case 'single':
                    const studentSelect = document.getElementById('studentSelect');
                    recipientText = studentSelect.options[studentSelect.selectedIndex]?.text || 'Not selected';
                    break;
                case 'multiple':
                    const selectedCount = document.querySelectorAll('.student-checkbox:checked').length;
                    recipientText = `${selectedCount} students selected`;
                    break;
                case 'all':
                    recipientText = 'All students (' + students.length + ')';
                    break;
                case 'custom':
                    recipientText = document.getElementById('customNumber').value || 'Custom number';
                    break;
            }
            
            previewRecipient.textContent = recipientText;
            
            // Update type info
            const alertType = document.getElementById('alertType').value;
            const sendToParent = document.getElementById('sendToParent').checked;
            
            let typeText = alertType ? alertType.charAt(0).toUpperCase() + alertType.slice(1) : 'Standard';
            if (sendToParent) {
                typeText += ' + Parent';
            }
            
            previewType.textContent = typeText;
        }

        // Send alert
        function sendAlert() {
            const recipientType = document.getElementById('recipientType').value;
            const message = document.getElementById('messageContent').value;
            const alertType = document.getElementById('alertType').value;
            const sendToParent = document.getElementById('sendToParent').checked;
            const scheduleTime = document.getElementById('scheduleTime').value;
            
            if (!message.trim()) {
                showStatus('Please enter a message', 'error');
                return;
            }
            
            let recipients = [];
            
            // Get recipients based on type
            switch(recipientType) {
                case 'single':
                    const studentId = document.getElementById('studentSelect').value;
                    if (!studentId) {
                        showStatus('Please select a student', 'error');
                        return;
                    }
                    const student = students.find(s => s.id == studentId);
                    recipients.push({ 
                        name: student.name, 
                        phone: student.phone,
                        type: 'student'
                    });
                    if (sendToParent) {
                        recipients.push({ 
                            name: `${student.name}'s Parent`, 
                            phone: student.parentPhone,
                            type: 'parent'
                        });
                    }
                    break;
                    
                case 'multiple':
                    const selectedStudents = document.querySelectorAll('.student-checkbox:checked');
                    if (selectedStudents.length === 0) {
                        showStatus('Please select at least one student', 'error');
                        return;
                    }
                    selectedStudents.forEach(checkbox => {
                        const student = students.find(s => s.id == checkbox.value);
                        recipients.push({ 
                            name: student.name, 
                            phone: student.phone,
                            type: 'student'
                        });
                        if (sendToParent) {
                            recipients.push({ 
                                name: `${student.name}'s Parent`, 
                                phone: student.parentPhone,
                                type: 'parent'
                            });
                        }
                    });
                    break;
                    
                case 'all':
                    students.forEach(student => {
                        recipients.push({ 
                            name: student.name, 
                            phone: student.phone,
                            type: 'student'
                        });
                        if (sendToParent) {
                            recipients.push({ 
                                name: `${student.name}'s Parent`, 
                                phone: student.parentPhone,
                                type: 'parent'
                            });
                        }
                    });
                    break;
                    
                case 'custom':
                    const customNumber = document.getElementById('customNumber').value;
                    if (!customNumber) {
                        showStatus('Please enter a phone number', 'error');
                        return;
                    }
                    recipients.push({ 
                        name: 'Custom Recipient', 
                        phone: customNumber,
                        type: 'custom'
                    });
                    break;
            }
            
            // Create alert record
            const alertRecord = {
                id: Date.now(),
                timestamp: scheduleTime ? new Date(scheduleTime).getTime() : Date.now(),
                scheduled: !!scheduleTime,
                recipients: recipients,
                message: message,
                type: alertType,
                status: scheduleTime ? 'pending' : 'sent'
            };
            
            // Add to history
            alertHistory.unshift(alertRecord);
            localStorage.setItem('alertHistory', JSON.stringify(alertHistory));
            
            // Show status
            if (scheduleTime) {
                showStatus(`Alert scheduled for ${new Date(scheduleTime).toLocaleString()}`, 'info');
            } else {
                showStatus(`Alert sent to ${recipients.length} recipient(s) successfully!`, 'success');
                
                // Simulate sending (in real app, this would call an API)
                simulateSending(recipients, message);
            }
            
            // Update UI
            loadAlertHistory();
            loadRecentActivity();
            
            // Clear form if not scheduled
            if (!scheduleTime) {
                clearForm();
            }
        }

        // Simulate sending messages (for demo purposes)
        function simulateSending(recipients, message) {
            console.log('Sending messages to:');
            recipients.forEach(recipient => {
                console.log(`- ${recipient.name} (${recipient.phone}): ${message}`);
                
                // In a real application, you would call an SMS API here
                // Example: Twilio, TextLocal, or your preferred SMS gateway
            });
            
            // Example of how you might integrate with an SMS API:
            /*
            fetch('/api/send-sms', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    recipients: recipients,
                    message: message
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus('Messages sent successfully!', 'success');
                } else {
                    showStatus('Failed to send some messages', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showStatus('Error sending messages', 'error');
            });
            */
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = '';
            }, 5000);
        }

        // Clear form
        function clearForm() {
            document.getElementById('messageContent').value = '';
            document.getElementById('alertType').value = '';
            document.getElementById('sendToParent').checked = false;
            document.getElementById('scheduleTime').value = '';
            document.getElementById('recipientType').value = 'single';
            
            // Clear template selections
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            toggleRecipientOptions();
            updateMessagePreview();
            showStatus('Form cleared', 'info');
        }

        // Load alert history
        function loadAlertHistory() {
            const container = document.getElementById('alertHistory');
            container.innerHTML = '';
            
            if (alertHistory.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No alert history found</div>';
                return;
            }
            
            alertHistory.forEach(alert => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const date = new Date(alert.timestamp).toLocaleString();
                const statusClass = `history-status status-${alert.status}`;
                
                historyItem.innerHTML = `
                    <div class="history-content">
                        <div class="history-message">${alert.message}</div>
                        <div class="history-meta">
                            <span>${date}</span>
                            <span>${alert.recipients.length} recipients</span>
                            <span>${alert.type}</span>
                        </div>
                    </div>
                    <div class="${statusClass}">${alert.status}</div>
                `;
                
                container.appendChild(historyItem);
            });
        }

        // Load recent activity
        function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '';
            
            const recentAlerts = alertHistory.slice(0, 3); // Last 3 alerts
            
            if (recentAlerts.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 10px; color: #666;">No recent activity</div>';
                return;
            }
            
            recentAlerts.forEach(alert => {
                const activityItem = document.createElement('div');
                activityItem.className = 'history-item';
                
                const date = new Date(alert.timestamp).toLocaleDateString();
                const time = new Date(alert.timestamp).toLocaleTimeString();
                
                activityItem.innerHTML = `
                    <div class="history-content">
                        <div class="history-message" style="font-size: 0.9rem;">${alert.message.substring(0, 50)}...</div>
                        <div class="history-meta">
                            <span>${date}</span>
                            <span>${time}</span>
                        </div>
                    </div>
                    <div class="history-status status-${alert.status}">${alert.status}</div>
                `;
                
                container.appendChild(activityItem);
            });
        }
    </script>
</body>
</html>